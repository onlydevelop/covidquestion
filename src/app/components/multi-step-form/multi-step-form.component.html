<div id="container" class="mu-4">
    <div class="progress">
        <span class="mr-4">Completion</span><div class="progress-bar progress-bar-striped bg-primary" role="progressbar" [style.width]="progress" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100"></div>
    </div>
    <h3>Covid 19 Survey</h3>
    <ng-container *ngFor="let form of masterForm; let i = index; trackBy: trackByFn">
        <form action="" [formGroup]="masterForm[i]" *ngIf="i === activeStepIndex || masterForm.length === 1">
            <div class="card card-body" >
                <div class="fields-container">
                    <div
                    *ngFor="let field of formFields[i]; trackBy: trackByFn"
                    [ngSwitch]="currentFormContent[i][field].type"
                    >
                        <label class="card-title" [for]="field">{{ currentFormContent[i][field].placeholder | formatTitle }}</label>
                        <br/>
                        <ng-container *ngSwitchCase="'textarea'">
                            <div class="form-group">
                                <textarea class="form-control"
                                [id]="field"
                                [formControlName]="field"
                                [placeholder]="currentFormContent[i][field].placeholder"></textarea>
                            </div>
                        </ng-container>

                        <ng-container *ngSwitchCase="'select'">
                            <select [formControlName]="field" [id]="field">
                                <option value="">{{ currentFormContent[i][field].placeholder }}</option>
                                <option
                                *ngFor="let option of currentFormContent[i][field].options; trackBy: trackByFn"
                                [value]="option.code"
                                >{{ option.name }}</option>
                            </select>
                        </ng-container>

                        <ng-container *ngSwitchCase="'checkbox'">
                            <div class="form-check" *ngFor="let option of currentFormContent[i][field].options; trackBy: trackByFn">
                                <input class="form-check-input" [formControlName]="field" type="checkbox" [value]="option.code" [id]="option.code">
                                <label class="form-check-label" for="option.code">
                                    {{ option.name }}
                                </label>
                            </div>
                        </ng-container>

                        <ng-container *ngSwitchCase="'radio'">
                            <div class="form-group" *ngFor="let option of currentFormContent[i][field].options; trackBy: trackByFn">
                                <div class="form-control">
                                        <input type="radio" [value]="option.code" [formControlName]="field">
                                        <span class="mr-4"></span>
                                        <label>
                                            {{ option.name }}
                                        </label>
                                </div>
                            </div>
                        </ng-container>

                        <ng-container *ngSwitchDefault>
                            <input
                                [type]="currentFormContent[i][field].type"
                                [formControlName]="field"
                                [id]="field"
                                [placeholder]="currentFormContent[i][field].placeholder"
                            />
                        </ng-container>

                    <p
                        class="validation-error"
                        *ngIf="
                        (masterForm[i].get(field).dirty ||
                            masterForm[i].get(field).touched) &&
                        masterForm[i].get(field).invalid &&
                        masterForm[i].get(field).errors
                        "
                    >
                        {{ getValidationMessage(i, field) }}
                    </p>
                    </div>
                </div>

                <div
                    class="preview-container"
                    *ngIf="activeStepIndex === stepItems.length - 1">
                    <ul>
                    <li
                        class="form-details-list"
                        *ngFor="let field of masterFormFields; trackBy: trackByFn">
                        <span class="text-bold">{{ field | formatTitle }}</span>
                        <span>{{ formData[field] || 'N/A' }}</span>
                    </li>
                    </ul>
                </div>

                <div class="button-container">
                    <button
                    type="button"
                    [class]="activeStepIndex ? 'btn btn-primary' : 'btn btn-secondary'"
                    [disabled]="!activeStepIndex"
                    (click)="goToStep('prev')"
                    >Previous</button>
                    <button
                    *ngIf="activeStepIndex === stepItems.length - 1"
                    type="button"
                    class="btn btn-info"
                    (click)="onFormSubmit()"
                    >Submit</button>
                    <button
                    type="button"
                    [class]="activeStepIndex === stepItems.length - 1 ? 'btn btn-secondary' : 'btn btn-primary'"
                    [disabled]="activeStepIndex === stepItems.length - 1 || masterForm[i].invalid"
                    (click)="goToStep('next')"
                    >Next</button>
                </div>
            </div>
        </form>
    </ng-container>
</div>


